<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>用户管理</title>
  <style>
    /* 复制原来的样式 */
    .header {
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .search-bar {
      display: flex;
      gap: 10px;
    }

    .search-bar input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 300px;
    }

    .button {
      background-color: #1e88e5;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .data-table {
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }

    .status-active {
      background-color: #e8f5e9;
      color: #4caf50;
    }

    .status-locked {
      background-color: #ffebee;
      color: #f44336;
    }

    .action-buttons {
      display: flex;
      gap: 5px;
    }

    .action-button {
      padding: 4px 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .edit-button {
      background-color: #e3f2fd;
      color: #1e88e5;
    }

    .delete-button {
      background-color: #ffebee;
      color: #f44336;
    }
  </style>
</head>
<body>
<div class="header">
  <h2>用户管理</h2>
  <div class="search-bar">
    <input type="text" placeholder="搜索用户...">
    <button class="button">搜索</button>
<!--    <button class="button" style="background-color: #4caf50;" onclick="showAddUserModal()">-->
<!--      添加用户-->
<!--    </button>-->
  </div>
</div>

<div class="filter-section" style="margin-bottom: 20px; background: white; padding: 15px; border-radius: 5px;">
  <div style="display: flex; gap: 15px;">
    <div>
      <label>账户状态：</label>
      <select id="statusFilter" style="padding: 5px;">
        <option value="all">全部</option>
        <option value="active">正常</option>
        <option value="locked">锁定</option>
      </select>
<!--    </div>-->
<!--    <div>-->
<!--      <label>注册时间：</label>-->
<!--      <input type="date" style="padding: 5px;">-->
<!--      <span>至</span>-->
<!--      <input type="date" style="padding: 5px;">-->
    </div>
<!--    <button class="button" style="height: 30px;">筛选</button>-->
  </div>
</div>

<div class="data-table">
  <table>
    <thead>
    <tr>
      <th><input type="checkbox" onclick="toggleAllUsers(this)"> 全选</th>
      <th>用户ID</th>
      <th>姓名</th>
      <th>账户号码</th>
      <th>手机号码</th>
      <th>家庭住址</th>
      <th>账户余额</th>
      <th>状态</th>
      <th>操作</th>
    </tr>
    </thead>
    <tbody id="userTableBody">
    <!-- 用户数据将通过 JavaScript 动态加载 -->
    </tbody>
  </table>

  <!-- 分页控件 -->
  <div style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
    <button class="button" style="background-color: #f5f5f5; color: #333;">上一页</button>
    <button class="button" style="background-color: #1e88e5;">1</button>
    <button class="button" style="background-color: #f5f5f5; color: #333;">2</button>
    <button class="button" style="background-color: #f5f5f5; color: #333;">3</button>
    <button class="button" style="background-color: #f5f5f5; color: #333;">下一页</button>
  </div>
</div>

<script src="js/axios.min.js"></script>
<script>
  let currentPage = 1;
  const pageSize = 10;

  // 页面加载时执行
  window.onload = function() {
    loadUserData();

    // 添加搜索按钮事件监听
    document.querySelector('.search-bar button').addEventListener('click', function() {
      loadUserData();
    });

    // 添加状态筛选事件监听
    document.getElementById('statusFilter').addEventListener('change', function() {
      loadUserData();
    });
  };

  // 加载用户数据
  function loadUserData() {
    const username = document.querySelector('.search-bar input').value;
    let status = document.getElementById('statusFilter').value;

    // 转换状态值
    if (status === 'active') status = '1';
    else if (status === 'locked') status = '0';
    else status = '';

    const queryData = {
      pageNum: currentPage,
      pageSize: pageSize,
      status: status,
      username: username
    };

    // 发起请求获取用户数据
    axios.post('/Users/list', queryData)
            .then(response => {
              if (response.data.code === 200) {
                renderUserTable(response.data.data.list);
                renderPagination(response.data.data);
              } else {
                alert('获取用户数据失败：' + response.data.msg);
              }
            })
            .catch(error => {
              console.error('获取用户数据错误:', error);
              alert('获取用户数据失败');
            });
  }

  // 渲染用户表格
  function renderUserTable(users) {
    const tbody = document.getElementById('userTableBody');
    tbody.innerHTML = users.map(user => `
            <tr>
                <td><input type="checkbox" name="userSelect" value="${user.id}"></td>
                <td>${user.id || '-'}</td>
                <td>${user.username || '-'}</td>
                <td>${user.bank_card || '-'}</td>
                <td>${user.phone || '-'}</td>
                <td>${user.address || '-'}</td>
                <td>${user.balance || '0.00'}</td>
                <td>
                    <span class="status-badge ${user.status === 1 ? 'status-active' : 'status-locked'}">
                        ${user.status === 1 ? '正常' : '锁定'}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="action-button edit-button" onclick="editUser(${user.id})">编辑</button>
                        <button class="action-button" style="background-color: #e3f2fd; color: #1e88e5;">
                            重置密码
                        </button>
                        <button class="action-button delete-button" onclick="toggleUserStatus(${user.id}, ${user.status})">
                            ${user.status === 1 ? '锁定' : '解锁'}
                        </button>
                    </div>
                </td>
            </tr>
        `).join('');
  }

  // 渲染分页控件
  function renderPagination(pageData) {
    const paginationDiv = document.querySelector('.data-table > div');
    const totalPages = pageData.pages;

    let paginationHtml = `
            <button class="button"
                ${currentPage === 1 ? 'disabled' : ''}
                onclick="changePage(${currentPage - 1})"
                style="background-color: #f5f5f5; color: #333;">
                上一页
            </button>
        `;

    // 生成页码按钮
    for (let i = 1; i <= totalPages; i++) {
      paginationHtml += `
                <button class="button"
                    onclick="changePage(${i})"
                    style="background-color: ${currentPage === i ? '#1e88e5' : '#f5f5f5'};
                           color: ${currentPage === i ? 'white' : '#333'}">
                    ${i}
                </button>
            `;
    }

    paginationHtml += `
            <button class="button"
                ${currentPage === totalPages ? 'disabled' : ''}
                onclick="changePage(${currentPage + 1})"
                style="background-color: #f5f5f5; color: #333;">
                下一页
            </button>
        `;

    paginationDiv.innerHTML = paginationHtml;
  }

  // 切换页码
  function changePage(page) {
    currentPage = page;
    loadUserData();
  }

  // 全选/取消全选
  function toggleAllUsers(checkbox) {
    const checkboxes = document.getElementsByName('userSelect');
    checkboxes.forEach(item => {
      item.checked = checkbox.checked;
    });
  }

  // 编辑用户
  function editUser(userId) {
    console.log('编辑用户:', userId);
    // TODO: 实现编辑用户功能
  }

  // 切换用户状态
  function toggleUserStatus(userId, currentStatus) {
    const newStatus = currentStatus === 1 ? 0 : 1;
    const action = newStatus === 1 ? '解锁' : '锁定';

    if (confirm(`确定要${action}该用户吗？`)) {
      // TODO: 实现用户状态切换功能
      console.log(`${action}用户:`, userId);
    }
  }
</script>
</body>
</html>